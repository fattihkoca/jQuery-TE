/*!
 * http://jqueryte.com
 * jQuery TE 1.0.6
 * Copyright (C) 2012, Fatih Koca (fatihkoca@me.com), AUTHOR.txt (http://jqueryte.com/about)
 * This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
You should have received a copy of the GNU General Public License along with this library; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 *
*/
(function(e){e.fn.jqte=function(t){var n=e.extend({css:"jqte",b:true,i:true,u:true,ol:true,ul:true,sub:true,sup:true,outdent:true,indent:true,strike:true,link:true,unlink:true,remove:true,rule:true},t);var r=e.extend({b:{cls:"bold",command:"Bold",key:"B",tags:["b","strong"]},i:{cls:"italic",command:"Italic",key:"I",tags:["i","em"]},u:{cls:"underline",command:"Underline",key:"U",tags:["u"]},ol:{cls:"orderedlist",command:"insertorderedlist",key:"¾",tags:["ol"]},ul:{cls:"unorderedlist",command:"insertunorderedlist",key:"¼",tags:["ul"]},sub:{cls:"subscript",command:"subscript",key:"(",tags:["sub"]},sup:{cls:"superscript",command:"superscript",key:"&",tags:["sup"]},outdent:{cls:"outdent",command:"outdent",key:"%",tags:["sup"]},indent:{cls:"indent",command:"indent",key:"'",tags:["sup"]},strike:{cls:"strike",command:"strikeThrough",key:"L",tags:["strike"]},link:{cls:"link",command:"createlink",key:"K",tags:["a"]},unlink:{cls:"unlink",command:"unlink",key:"N",tags:["a"]},remove:{cls:"remove",command:"removeformat",key:".",css:false},hr:{cls:"rule",command:"inserthorizontalrule",key:"H",tags:["hr"]}},t);return this.each(function(){function a(e){var t,n,r=navigator.userAgent.toLowerCase(),i=null;if(window.getSelection){n=window.getSelection();if(n.getRangeAt){t=n.getRangeAt(0)}if(t){n.removeAllRanges();n.addRange(t)}if(e=="createlink")var i=l(t);if(!r.match(/msie/))document.execCommand("StyleWithCSS",false,false);document.execCommand(e,false,i)}else if(document.selection&&document.selection.createRange&&document.selection.type!="None"){t=document.selection.createRange();if(e=="createlink")var i=l(t);t.execCommand(e,false,i)}}function l(e){thisSelected=f();thisTagName=thisSelected.prop("tagName").toLowerCase();thisHrefLink="http://";if(thisTagName=="a"&&thisSelected.is("[href]"))thisHrefLink=thisSelected.attr("href");return prompt("URL:",thisHrefLink)}function c(t,n){var r=false,i=f(),s,o;e.each(t,function(t,n){s=i.prop("tagName").toLowerCase();o=i.attr("style");if(s==n)r=true;else{i.parents().each(function(){s=e(this).prop("tagName").toLowerCase();if(s==n)r=true})}});return r}function h(t){if(n.b)c(r.b.tags,r.b.css)?s.find("."+r.b.cls).addClass(u):e("."+r.b.cls).removeClass(u);if(n.i)c(r.i.tags,r.i.css)?s.find("."+r.i.cls).addClass(u):e("."+r.i.cls).removeClass(u);if(n.u)c(r.u.tags,r.u.css)?s.find("."+r.u.cls).addClass(u):e("."+r.u.cls).removeClass(u);if(n.ol)c(r.ol.tags,r.ol.css)?s.find("."+r.ol.cls).addClass(u):e("."+r.ol.cls).removeClass(u);if(n.ul)c(r.ul.tags,r.ul.css)?s.find("."+r.ul.cls).addClass(u):e("."+r.ul.cls).removeClass(u);if(n.sub)c(r.sub.tags,r.sub.css)?s.find("."+r.sub.cls).addClass(u):e("."+r.sub.cls).removeClass(u);if(n.sup)c(r.sup.tags,r.sup.css)?s.find("."+r.sup.cls).addClass(u):e("."+r.sup.cls).removeClass(u);if(n.strike)c(r.strike.tags,r.strike.css)?s.find("."+r.strike.cls).addClass(u):e("."+r.strike.cls).removeClass(u)}function p(){var e=o.html().replace(/<p><\/p>/g,"").replace(/ /g," ").replace(/<p> <\/p>/g,""),n,r;n=[/\<div>(.*?)\<\/div>/ig,/\<br>(.*?)\<br>/ig,/\<br\/>(.*?)\<br\/>/ig,/\<strong>(.*?)\<\/strong>/ig,/\<em>(.*?)\<\/em>/ig];r=["<p>$1</p>","<p>$1</p>","<p>$1</p>","<b>$1</b>","<i>$1</i>"];for(var i=0;i<n.length;i++){e=e.replace(n[i],r[i])}t.val(o.html())}var t=e(this);t.hide().before('<div class="'+n.css+'" ></div>');var i=t.prev("."+n.css);i.html('<div class="'+n.css+"_Panel"+'" unselectable="on"></div> <div class="'+n.css+"_Content"+'" contenteditable="true"></div>');var s=i.find("."+n.css+"_Panel");var o=i.find("."+n.css+"_Content");var u=n.css+"_Active";o.html(t.val());s.bind("selectstart mousedown",function(e){e.preventDefault()});if(n.b)s.append('<a class="'+r.b.cls+'" toggletag="'+r.b.command+'" unselectable="on"></a>');if(n.i)s.append('<a class="'+r.i.cls+'" toggletag="'+r.i.command+'" unselectable="on"></a>');if(n.u)s.append('<a class="'+r.u.cls+'" toggletag="'+r.u.command+'" unselectable="on"></a>');if(n.ol)s.append('<a class="'+r.ol.cls+'" toggletag="'+r.ol.command+'" unselectable="on"></a>');if(n.ul)s.append('<a class="'+r.ul.cls+'" toggletag="'+r.ul.command+'" unselectable="on"></a>');if(n.sub)s.append('<a class="'+r.sub.cls+'" toggletag="'+r.sub.command+'" unselectable="on"></a>');if(n.sup)s.append('<a class="'+r.sup.cls+'" toggletag="'+r.sup.command+'" unselectable="on"></a>');if(n.outdent)s.append('<a class="'+r.outdent.cls+'" toggletag="'+r.outdent.command+'" unselectable="on"></a>');if(n.indent)s.append('<a class="'+r.indent.cls+'" toggletag="'+r.indent.command+'" unselectable="on"></a>');if(n.strike)s.append('<a class="'+r.strike.cls+'" toggletag="'+r.strike.command+'" unselectable="on"></a>');if(n.link)s.append('<a class="'+r.link.cls+'" toggletag="'+r.link.command+'" unselectable="on"></a>');if(n.unlink)s.append('<a class="'+r.unlink.cls+'" toggletag="'+r.unlink.command+'" unselectable="on"></a>');if(n.remove)s.append('<a class="'+r.remove.cls+'" toggletag="'+r.remove.command+'" unselectable="on"></a>');if(n.rule)s.append('<a class="'+r.hr.cls+'" toggletag="'+r.hr.command+'" unselectable="on"></a>');o.focusout(function(){s.find("a").removeClass(u)});var f=function(){var t,n;if(window.getSelection){n=getSelection();t=n.anchorNode}if(!t&&document.selection){n=document.selection;var r=n.getRangeAt?n.getRangeAt(0):n.createRange();t=r.commonAncestorContainer?r.commonAncestorContainer:r.parentElement?r.parentElement():r.item(0)}if(t){return t.nodeName=="#text"?e(t.parentNode):e(t)}};s.find("a").click(function(){if(o.not(":focus"))o.focus();a(e(this).attr("toggletag"));p();e(this).hasClass(u)||e(this).is("[toggletag="+r.remove.command+"]")||e(this).is("[toggletag="+r.hr.command+"]")||e(this).is("[toggletag="+r.indent.command+"]")||e(this).is("[toggletag="+r.outdent.command+"]")||e(this).is("[toggletag="+r.link.command+"]")||e(this).is("[toggletag="+r.unlink.command+"]")?e(this).removeClass(u):e(this).addClass(u)});e.ctrl=function(e,t,n){o.keydown(function(r){if(!n)n=[];if(r.keyCode==e.charCodeAt(0)&&r.ctrlKey){t.apply(this,n);return false}})};e.ctrl(r.b.key,function(){a(r.b.command)});e.ctrl(r.i.key,function(){a(r.i.command)});e.ctrl(r.u.key,function(){a(r.u.command)});e.ctrl(r.ol.key,function(){a(r.ol.command)});e.ctrl(r.ul.key,function(){a(r.ul.command)});e.ctrl(r.sub.key,function(){a(r.sub.command)});e.ctrl(r.sup.key,function(){a(r.sup.command)});e.ctrl(r.indent.key,function(){a(r.indent.command)});e.ctrl(r.outdent.key,function(){a(r.outdent.command)});e.ctrl(r.strike.key,function(){a(r.strike.command)});e.ctrl(r.link.key,function(){a(r.link.command)});e.ctrl(r.unlink.key,function(){a(r.unlink.command)});e.ctrl(r.remove.key,function(){a(r.remove.command)});e.ctrl(r.hr.key,function(){a(r.hr.command)});o.bind("mouseup keyup",h).bind("keypress keyup keydown drop cut copy paste DOMCharacterDataModified DOMSubtreeModified",function(){e(this).trigger("change")}).bind("change",function(){setTimeout(p,0)})})}})(jQuery)